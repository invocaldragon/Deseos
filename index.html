<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Deseos</title>

  <!-- üé® Estilos -->
<style>
  /* üåº Estilo general */
  body {
    font-family: 'Segoe UI', sans-serif;
    background: #fefcf6;
    color: #2d2d2d;
    margin: 0;
    padding: 0;
    text-align: center;
  }

  h1 {
    margin-top: 1.2em;
    font-size: 1.8em;
    color: #2d2d2d;
  }

  h2 {
    margin-top: 2em;
    font-size: 1.4em;
    color: #444;
  }

  /* üì¶ Deseo */
  .deseo {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.06);
    margin: 1.5em auto;
    padding: 1.3em 1.2em;
    max-width: 500px;
    transition: 0.3s ease;
  }

  .deseo:hover {
    transform: scale(1.01);
    box-shadow: 0 6px 20px rgba(0,0,0,0.08);
  }

  .votos {
    font-size: 14px;
    color: #999;
    margin-top: 0.4em;
  }

  .alias {
    margin-top: 0.4em;
    font-style: italic;
    font-size: 14px;
    color: #777;
  }

  /* ‚ú® Botones */
  .boton {
    background: #f4c542;
    color: #2d2d2d;
    padding: 12px 26px;
    border: none;
    border-radius: 30px;
    font-size: 16px;
    cursor: pointer;
    margin: 1.2em auto 0.5em;
    display: inline-block;
    transition: background 0.25s ease;
  }

  .boton:hover {
    background: #ffe082;
    color: #111;
  }

  .boton-flotante {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #f4c542;
    color: #2d2d2d;
    padding: 14px 20px;
    border-radius: 30px;
    font-size: 14px;
    z-index: 1000;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    cursor: pointer;
  }

  .boton-flotante:hover {
    background: #ffe082;
    color: #111;
  }

  /* ‚úçÔ∏è Inputs */
  .campo-texto {
    width: 85%;
    padding: 14px;
    margin-top: 1em;
    border-radius: 10px;
    border: 1px solid #ccc;
    font-size: 16px;
    background: #fff;
    color: #333;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.03);
  }

  .campo-texto::placeholder {
    color: #aaa;
  }

  /* üìê Secciones */
  .seccion {
    margin: 2.5em 1em;
  }

  #contador-global {
    margin-top: 3em;
    color: #999;
    font-size: 14px;
  }

  footer {
    font-size: 13px;
    color: #999;
    padding: 2em 1em 5em;
  }

  footer a {
    color: #999;
    text-decoration: none;
  }

  footer a:hover {
    text-decoration: underline;
    color: #f4c542;
  }

  /* üí´ Pulso temporal (nuevo deseo) */
  .pulso-temporal {
    animation: pulsoSuave 1.4s ease-in-out infinite;
  }

  @keyframes pulsoSuave {
    0%   { box-shadow: 0 0 0px rgba(244, 197, 66, 0.2); }
    50%  { box-shadow: 0 0 16px rgba(244, 197, 66, 0.5); }
    100% { box-shadow: 0 0 0px rgba(244, 197, 66, 0.2); }
  }

  /* üç™ Cookies */
  #cookieBanner {
    font-size: 14px;
    line-height: 1.5;
    background: #fffaf0;
    color: #444;
    border-top: 1px solid #eee;
  }

  /* üì± Responsive */
  @media (max-width: 600px) {
    h1 { font-size: 1.5em; }
    h2 { font-size: 1.2em; }
    .campo-texto { width: 90%; }
    .boton { width: 90%; }
    .deseo { margin: 1em 1em; }
  }

  /* üå† Hero */
  .hero {
    background: linear-gradient(to bottom, #fffbe7, #fdfcf6);
    padding: 80px 20px 60px;
    color: #2d2d2d;
    text-align: center;
  }

  .hero h1 {
    font-size: 2.2em;
    margin-bottom: 0.4em;
    color: #f4c542;
  }

  .hero-sub {
    font-size: 16px;
    color: #666;
    max-width: 500px;
    margin: 0 auto 1.8em;
    line-height: 1.5;
  }

  .boton-hero {
    background: #f4c542;
    color: #2d2d2d;
    border: none;
    font-size: 18px;
    padding: 14px 30px;
    border-radius: 30px;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    transition: background 0.3s ease;
  }

  .boton-hero:hover {
    background: #ffe082;
    color: #111;
  }
</style>


</head>

<body>

<section class="hero">
  <h1>üå† Pide tu deseo</h1>
  <p class="hero-sub">Miles ya lo hicieron. ¬øQu√© deseas t√∫ profundamente?</p>
  <button class="boton-hero" onclick="irAEscribir()">‚ú® Escribir mi deseo</button>
</section>


  <!-- üåü Top Semanal -->
  <h1>üèÜ Deseos m√°s votados del mundo esta semana</h1>
  <p style="font-size: 14px; color: #666; margin-top: -10px;">
    Los deseos que m√°s han tocado corazones. <br>Votados por la comunidad. Firmados por quienes se atrevieron a desear.
  </p>
  <div id="top-semanal" class="seccion"></div>
  <p style="color: #666; font-size: 14px; margin-top: -8px;">
    üí´ Este ranking se actualiza con cada voto. ¬øYa diste el tuyo?
  </p>

  <!-- ‚úçÔ∏è Bot√≥n de invocaci√≥n -->
  <button class="boton" onclick="irAEscribir()">‚ú® Escribe tu deseo</button>

  <!-- üìù Secci√≥n: escribir deseo -->
  <div id="seccion-escribir" class="seccion">
    <h2>¬øQu√© deseas profundamente?</h2>
    <textarea id="deseoInput" class="campo-texto" rows="3" placeholder="Escribe tu deseo aqu√≠..."></textarea><br>
    <input type="text" id="aliasInput" class="campo-texto" placeholder="Tu alias (opcional)"><br>
    <p style="font-size: 13px; color: #777; margin-top: 6px;">
      Tu alias es opcional. Es como firmar tu deseo. <br>Si lo dejas vac√≠o, ser√° enviado como <strong>‚ÄúAn√≥nimo‚Äù</strong>.
    </p>
    <button class="boton" onclick="enviarDeseo()">Enviar mi deseo</button>
    <div id="resultadoEnvio"></div>
  </div>

  <!-- üó≥Ô∏è Secci√≥n: votaci√≥n -->
  <div id="seccion-votar" class="seccion">
    <h2>Vota por los deseos que te inspiran</h2>


    <div id="zonaVotacion"></div>

<button class="boton" onclick="renderVotacion()">üîÅ Refrescar lista de deseos</button>

  </div>

  <!-- üìà Contador total -->
  <div id="contador-global"></div>

  <!-- ‚ú® Bot√≥n flotante -->
  <div class="boton-flotante" onclick="irAEscribir()">‚ú® Escribir deseo</div>

  <footer>
    <p>
      üìñ <a href="#terminos-uso">T√©rminos de Uso</a> ¬∑
      <a href="#politica-cookies">Cookies</a> ¬∑
      <a href="#privacidad">Privacidad</a>
    </p>
  </footer>

<section id="terminos-uso" style="padding: 2em; font-size: 15px; color: #444; max-width: 600px; margin: auto; text-align: left;">
  <h2 style="text-align: center;">üìú T√©rminos y Condiciones de Uso</h2>
  <p><strong>Bienvenido/a a Deseos.</strong> Este espacio ha sido creado para que cualquier persona, en cualquier parte del mundo, pueda expresar sus deseos, leer los de otros, y conectar con algo m√°s grande que uno mismo.</p>
  <h3>1. Aceptaci√≥n</h3>
  <p>Al usar este sitio, aceptas estos t√©rminos de forma voluntaria y consciente. Si no est√°s de acuerdo con alguna parte, simplemente no uses la plataforma.</p>
  <h3>2. Uso del sitio</h3>
  <ul>
    <li>Puedes escribir tus deseos, reales o simb√≥licos.</li>
    <li>Puedes votar por los deseos que te inspiren.</li>
    <li>Puedes compartir tus deseos si lo deseas, pero es completamente opcional.</li>
    <li>No necesitas registrarte ni compartir informaci√≥n personal.</li>
  </ul>
  <h3>3. Contenido permitido</h3>
  <p>Est√° prohibido publicar deseos que contengan lenguaje ofensivo, violento, discriminatorio, spam o enlaces externos.</p>
  <h3>4. Derechos del contenido</h3>
  <p>Los deseos son de sus autores. Autorizas a Deseos a mostrarlos p√∫blicamente de forma respetuosa.</p>
  <h3>5. Limitaci√≥n de responsabilidad</h3>
  <p>Deseos es un espacio simb√≥lico. No garantiza que los deseos se cumplan.</p>
  <h3>6. Cambios en estos t√©rminos</h3>
  <p>Podemos actualizar estos t√©rminos sin previo aviso.</p>
  <h3>7. Contacto</h3>
  <p>Escr√≠benos a: contacto@tudominio.com</p>
  <p style="font-size: 13px; color: #888;">√öltima actualizaci√≥n: junio de 2025</p>
</section>

<section id="politica-cookies" style="padding: 2em; font-size: 15px; color: #444; max-width: 600px; margin: auto; text-align: left;">
  <h2 style="text-align: center;">üç™ Pol√≠tica de Cookies</h2>
  <p>Usamos cookies m√≠nimas para que el sitio funcione correctamente. No rastreamos ni vendemos tu informaci√≥n.</p>
  <h3>¬øQu√© son las cookies?</h3>
  <p>Peque√±os archivos que mejoran la experiencia. Aqu√≠ solo se usan para recordar si aceptaste el banner.</p>
  <h3>¬øQu√© cookies usamos?</h3>
  <ul>
    <li><strong>Cookies t√©cnicas:</strong> necesarias para el funcionamiento.</li>
    <li>No usamos cookies publicitarias ni de terceros.</li>
  </ul>
  <p style="font-size: 13px; color: #888;">√öltima actualizaci√≥n: junio de 2025</p>
</section>

<section id="privacidad" style="padding: 2em; font-size: 15px; color: #444; max-width: 600px; margin: auto; text-align: left;">
  <h2 style="text-align: center;">üïäÔ∏è Pol√≠tica de Privacidad</h2>
  <p>Solo recogemos el texto del deseo y un alias opcional. Nada m√°s. No almacenamos tu IP ni datos personales.</p>
  <p>Tu deseo se guarda de forma an√≥nima en una hoja protegida. Solo se usa para mostrarlo aqu√≠.</p>
  <p>No vendemos, analizamos ni compartimos nada contigo. Aqu√≠ tus deseos son solo tuyos.</p>
  <p style="font-size: 13px; color: #888;">√öltima actualizaci√≥n: junio de 2025</p>
</section>

  <div id="cookieBanner" style="position: fixed; bottom: 0; left: 0; right: 0; background: #111; color: white; padding: 1em; font-size: 14px; display: flex; flex-direction: column; align-items: center; z-index: 9999;">
    <span style="margin-bottom: 0.5em; text-align: center;">
      Usamos cookies m√≠nimas para mejorar tu experiencia. No rastreamos, no vendemos, no te seguimos.<br>
      <a href="#politica-cookies" style="color: #ffd700; text-decoration: underline;">Leer m√°s</a>
    </span>
    <button onclick="aceptarCookies()" style="background: #ffd700; color: black; border: none; padding: 6px 16px; border-radius: 20px; cursor: pointer;">Aceptar</button>
  </div>



  <!-- ‚öôÔ∏è Script principal -->
<script>





let deseoReciente = null;




  const scriptURL = 'https://script.google.com/macros/s/AKfycbzCTUMu-CJtv_tzo-vJhx6-z-ft1n4HVx9DfAeHkwTtGVqpxtPbXA_mxOCmAeRtYR1Y/exec';
  let todosLosDeseos = [];

  function irAEscribir() {
    document.getElementById('seccion-escribir').scrollIntoView({ behavior: 'smooth' });
  }

  async function cargarDatosIniciales() {
    try {
      const res = await fetch(scriptURL);
      todosLosDeseos = await res.json();
      renderTop();
      renderVotacion();
    } catch (error) {
      console.error('Error al cargar los deseos:', error);
    }
  }

  function renderTop() {
    const top3 = [...todosLosDeseos]
      .sort((a, b) => b.votos - a.votos)
      .slice(0, 3);

    document.getElementById('top-semanal').innerHTML = top3.map(d =>
      `<div class="deseo">
        <div>${d.texto}</div>
        <div class="alias">‚Äî ${d.nombre || 'An√≥nimo'}</div>
        <div class="votos">üåü ${d.votos || 0} votos</div>
      </div>`
    ).join('');

    document.getElementById('contador-global').innerText =
      `üåé M√°s de ${todosLosDeseos.length} deseos enviados.`;
  }

function renderVotacion() {
  const contenedor = document.getElementById('zonaVotacion');
  let mezcla = [];

  if (deseoReciente) {
    // Incluye el nuevo deseo una vez
    const otros = todosLosDeseos.filter(d => d.id !== deseoReciente.id);
    const aleatorios = otros.sort(() => 0.5 - Math.random()).slice(0, 2);
    mezcla = [deseoReciente, ...aleatorios];
    deseoReciente = null; // ‚úÖ se muestra solo una vez
  } else {
    // Flujo normal
    mezcla = todosLosDeseos.sort(() => 0.5 - Math.random()).slice(0, 3);
  }


// Quitar cualquier pulso anterior
document.querySelectorAll('.pulso-temporal').forEach(el => el.classList.remove('pulso-temporal'));


  contenedor.innerHTML = mezcla.map(d => {
    const votosTexto = d.votos && d.votos > 0
      ? `<div class='votos' style='font-size:13px; color:#999; margin-top:4px;'>üåü ${d.votos} votos</div>`
      : '';
    return `
      <div class="deseo">
        <div>${d.texto}</div>
        <div class="alias">‚Äî ${d.nombre || 'An√≥nimo'}</div>
        ${votosTexto}
        <button class="boton" onclick="votarDeseo('${d.id}')">‚ú® Votar</button>
      </div>`;
  }).join('');
}

  async function enviarDeseo() {
    const texto = document.getElementById('deseoInput').value.trim();
    const alias = document.getElementById('aliasInput').value.trim() || "An√≥nimo";
    if (!texto) return alert('Escribe un deseo antes de enviarlo.');

    const data = new FormData();
    data.append('deseo', texto);
    data.append('alias', alias);

    try {
      const res = await fetch(scriptURL, {
        method: 'POST',
        body: data
      });
      const result = await res.json();
      if (result.result === 'success') {
document.getElementById('resultadoEnvio').innerHTML = `
  <p>‚ú® Tu deseo fue enviado al universo.</p>
  <button class="boton" onclick="compartirDeseo('${texto}')">üì§ Compartir deseo</button>`;

document.getElementById('deseoInput').value = '';
document.getElementById('aliasInput').value = '';

// üëâ Crear el nuevo deseo una sola vez
const nuevoDeseo = {
  id: (todosLosDeseos.length + 1).toString().padStart(3, '0'),
  nombre: alias,
  texto: texto,
  votos: 0
};

// üëâ Guardar en memoria
todosLosDeseos.push(nuevoDeseo);
deseoReciente = nuevoDeseo; // se forzar√° a mostrar una sola vez

// üëâ Refrescar contador y lista
renderTop();
renderVotacion();

setTimeout(() => {
  const primerDeseo = document.querySelector('#zonaVotacion .deseo');
  if (primerDeseo) {
    primerDeseo.classList.add('pulso-temporal');
  }
}, 100);


}
 else {
        alert('Error al enviar el deseo.');
      }
    } catch (error) {
      console.error('Error al enviar:', error);
    }
  }

  function compartirDeseo(texto) {
    const mensaje = `Yo ya ped√≠ mi deseo al universo:\n${texto}\n‚ú® T√∫ tambi√©n puedes hacerlo en deseos.com`;
    const url = `https://wa.me/?text=${encodeURIComponent(mensaje)}`;
    window.open(url, '_blank');
  }

  async function votarDeseo(id) {
    const data = new FormData();
    data.append('desireId', id);
    const contenedor = document.getElementById('zonaVotacion');
    const boton = document.querySelector(`button[onclick="votarDeseo('${id}')"]`);

    if (boton) {
      boton.disabled = true;
      boton.innerHTML = '‚úÖ ¬°Gracias por tu voto!';
    }

    try {
      const res = await fetch(scriptURL, {
        method: 'POST',
        body: data
      });
      const result = await res.json();

      if (result.result === 'success') {
        // Actualiza votos en memoria
        const index = todosLosDeseos.findIndex(d => d.id === id);
        if (index !== -1) {
          todosLosDeseos[index].votos = (todosLosDeseos[index].votos || 0) + 1;
        }

        contenedor.style.opacity = '0';

        setTimeout(async () => {
          // Mostrar mensaje din√°mico de carga
          const mensaje = document.createElement('div');
          mensaje.innerText = 'üîÑ Cargando nuevos deseos inspiradores...';
          mensaje.style.fontSize = '14px';
          mensaje.style.color = '#777';
          mensaje.style.marginTop = '1em';
          mensaje.style.opacity = '0';
          mensaje.style.transition = 'opacity 0.3s ease';
          contenedor.innerHTML = '';
          contenedor.appendChild(mensaje);
          setTimeout(() => { mensaje.style.opacity = '1'; }, 10);

          renderVotacion();
          renderTop();

          mensaje.remove();
          contenedor.style.opacity = '1';
        }, 100);

      } else {
        alert('Error al votar.');
        if (boton) {
          boton.disabled = false;
          boton.innerHTML = '‚ú® Votar';
        }
      }
    } catch (error) {
      console.error('Error al votar:', error);
      if (boton) {
        boton.disabled = false;
        boton.innerHTML = '‚ú® Votar';
      }
    }
  }


  // Inicia al cargar
  cargarDatosIniciales();


// üßÅ Gesti√≥n de cookies
document.addEventListener('DOMContentLoaded', () => {
  const banner = document.getElementById("cookieBanner");
  if (!banner) return;

  if (localStorage.getItem("cookiesAceptadas") === "true") {
    banner.style.display = "none";
  } else {
    banner.style.display = "block";
  }
});

function aceptarCookies() {
  localStorage.setItem("cookiesAceptadas", "true");
  const banner = document.getElementById("cookieBanner");
  if (banner) banner.style.display = "none";
}





</script>

</body>
</html>
