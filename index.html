<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Deseos</title>
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond&family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Quicksand', sans-serif;
      background: linear-gradient(to bottom, #fffbe7, #fdfcf6);
      color: #2d2d2d;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    h1, h2 {
      font-family: 'EB Garamond', serif;
      color: #d4a500;
    }

    h1 {
      font-size: 2.4em;
      margin-top: 1em;
    }

    h2 {
      font-size: 1.6em;
      margin-top: 2em;
    }

    .hero {
      background-image: url('https://images.unsplash.com/photo-1506748686214-e9df14d4d9d0?auto=format&fit=crop&w=1600&q=80');
      background-size: cover;
      background-position: center;
      color: white;
      padding: 60px 20px 100px;
      text-shadow: 1px 1px 4px rgba(0,0,0,0.4);
    }

    .hero h1 {
      font-size: 2.8em;
      color: #ffd700;
    }

    .hero-sub {
      max-width: 600px;
      margin: 0 auto 2em;
      font-size: 1.1em;
    }

    .boton, .boton-hero {
      background: #ffd700;
      color: #2d2d2d;
      padding: 14px 30px;
      border: none;
      border-radius: 30px;
      font-size: 1em;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .boton:hover, .boton-hero:hover {
      background: #fff3a3;
      transform: scale(1.05);
    }

.boton-votar {
  background: #e0f7ff;
  color: #007fa3;
  border: 2px solid #007fa3;
  padding: 12px 24px;
  border-radius: 25px;
  font-weight: bold;
  transition: background 0.3s ease, color 0.3s ease, transform 0.2s;
  box-shadow: 0 2px 6px rgba(0, 127, 163, 0.2);
}

.boton-votar:hover {
  background: #007fa3;
  color: #fff;
  transform: scale(1.05);
}


    .deseo {
      background: white;
      border-radius: 20px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.06);
      margin: 2em auto;
      padding: 1.5em 1.2em;
      max-width: 600px;
      position: relative;
      transition: 0.4s ease;
    }

    .deseo:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }

    .alias, .votos {
      font-size: 0.9em;
      color: #777;
      margin-top: 0.4em;
    }

    .campo-texto {
      width: 90%;
      padding: 16px;
      margin-top: 1em;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: 1em;
      background: #fff;
      color: #333;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.04);
    }

    .seccion {
      margin: 3em 1em;
    }

    .boton-flotante {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #ffd700;
      color: #2d2d2d;
      padding: 14px 20px;
      border-radius: 30px;
      font-size: 14px;
      z-index: 1000;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      cursor: pointer;
    }

    footer {
      font-size: 0.9em;
      color: #aaa;
      padding: 3em 1em;
    }

    footer a {
      color: #aaa;
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
      color: #d4a500;
    }

    #contador-global {
      margin-top: 3em;
      font-size: 0.9em;
      color: #999;
    }

    @media (max-width: 600px) {
      h1 { font-size: 1.8em; }
      .hero-sub { font-size: 1em; }
      .boton, .campo-texto { width: 95%; }
    }

    /* üéá Nuevo deseo resalta */
    .pulso-temporal {
      animation: resplandor 1.8s ease-in-out infinite;
    }

    @keyframes resplandor {
      0% { box-shadow: 0 0 0px rgba(255, 215, 0, 0.4); }
      50% { box-shadow: 0 0 18px rgba(255, 215, 0, 0.8); }
      100% { box-shadow: 0 0 0px rgba(255, 215, 0, 0.4); }
    }
  </style>
</head>
<body>
  <section class="hero">
    <h1>üå† Pide tu deseo</h1>
    <p class="hero-sub">Miles ya lo hicieron. ¬øQu√© desea profundamente tu alma hoy?</p>
    <button class="boton-hero" onclick="irAEscribir()">‚ú® Escribir mi deseo</button>
  </section>

  <h1>üèÜ Los deseos que m√°s han brillado esta semana</h1>
  <p style="font-size: 14px; color: #666; margin-top: -10px;">
    Los m√°s votados por la comunidad. D√©jate inspirar.
  </p>
  <div id="top-semanal" class="seccion"></div>
  <p style="color: #666; font-size: 14px; margin-top: -8px;">
    üí´ Este ranking se actualiza con cada voto. ¬øYa diste el tuyo?
  </p>

  <button class="boton" onclick="irAEscribir()">üí´ Escribe tu deseo</button>

  <div id="seccion-escribir" class="seccion">
    <h2>¬øQu√© deseas profundamente?</h2>
    <textarea id="deseoInput" class="campo-texto" rows="3" placeholder="Escribe tu deseo aqu√≠..."></textarea><br>
    <input type="text" id="aliasInput" class="campo-texto" placeholder="Tu alias (opcional)"><br>
    <p style="font-size: 13px; color: #777; margin-top: 6px;">
      Tu alias es opcional. Es como firmar tu deseo. Si lo dejas vac√≠o, ser√° An√≥nimo.
    </p>
    <button class="boton" onclick="enviarDeseo()">üåü Enviar deseo</button>
    <div id="resultadoEnvio"></div>
  </div>

  <div id="seccion-votar" class="seccion">
    <h2>Vota por los deseos que toquen tu coraz√≥n</h2>
    <div id="zonaVotacion"></div>
    <button class="boton-votar" onclick="renderVotacion()">üîÅ Ver otros deseos</button>
  </div>

  <div id="contador-global"></div>
  <div class="boton-flotante" onclick="irAEscribir()">‚ú® Escribir deseo</div>
  <footer>
    <p>
      üìñ <a href="#terminos-uso">T√©rminos de Uso</a> ¬∑
      <a href="#politica-cookies">Cookies</a> ¬∑
      <a href="#privacidad">Privacidad</a>
    </p>
  </footer>

<section id="terminos-uso" style="padding: 2em; font-size: 15px; color: #444; max-width: 600px; margin: auto; text-align: left;">
  <h2 style="text-align: center;">üìú T√©rminos y Condiciones de Uso</h2>
  <p><strong>Bienvenido/a a Deseos.</strong> Este espacio ha sido creado para que cualquier persona, en cualquier parte del mundo, pueda expresar sus deseos, leer los de otros, y conectar con algo m√°s grande que uno mismo.</p>
  <h3>1. Aceptaci√≥n</h3>
  <p>Al usar este sitio, aceptas estos t√©rminos de forma voluntaria y consciente. Si no est√°s de acuerdo con alguna parte, simplemente no uses la plataforma.</p>
  <h3>2. Uso del sitio</h3>
  <ul>
    <li>Puedes escribir tus deseos, reales o simb√≥licos.</li>
    <li>Puedes votar por los deseos que te inspiren.</li>
    <li>Puedes compartir tus deseos si lo deseas, pero es completamente opcional.</li>
    <li>No necesitas registrarte ni compartir informaci√≥n personal.</li>
  </ul>
  <h3>3. Contenido permitido</h3>
  <p>Est√° prohibido publicar deseos que contengan lenguaje ofensivo, violento, discriminatorio, spam o enlaces externos.</p>
  <h3>4. Derechos del contenido</h3>
  <p>Los deseos son de sus autores. Autorizas a Deseos a mostrarlos p√∫blicamente de forma respetuosa.</p>
  <h3>5. Limitaci√≥n de responsabilidad</h3>
  <p>Deseos es un espacio simb√≥lico. No garantiza que los deseos se cumplan.</p>
  <h3>6. Cambios en estos t√©rminos</h3>
  <p>Podemos actualizar estos t√©rminos sin previo aviso.</p>
  <h3>7. Contacto</h3>
  <p>Escr√≠benos a: contacto@tudominio.com</p>
  <p style="font-size: 13px; color: #888;">√öltima actualizaci√≥n: junio de 2025</p>
</section>

<section id="politica-cookies" style="padding: 2em; font-size: 15px; color: #444; max-width: 600px; margin: auto; text-align: left;">
  <h2 style="text-align: center;">üç™ Pol√≠tica de Cookies</h2>
  <p>Usamos cookies m√≠nimas para que el sitio funcione correctamente. No rastreamos ni vendemos tu informaci√≥n.</p>
  <h3>¬øQu√© son las cookies?</h3>
  <p>Peque√±os archivos que mejoran la experiencia. Aqu√≠ solo se usan para recordar si aceptaste el banner.</p>
  <h3>¬øQu√© cookies usamos?</h3>
  <ul>
    <li><strong>Cookies t√©cnicas:</strong> necesarias para el funcionamiento.</li>
    <li>No usamos cookies publicitarias ni de terceros.</li>
  </ul>
  <p style="font-size: 13px; color: #888;">√öltima actualizaci√≥n: junio de 2025</p>
</section>

<section id="privacidad" style="padding: 2em; font-size: 15px; color: #444; max-width: 600px; margin: auto; text-align: left;">
  <h2 style="text-align: center;">üïäÔ∏è Pol√≠tica de Privacidad</h2>
  <p>Solo recogemos el texto del deseo y un alias opcional. Nada m√°s. No almacenamos tu IP ni datos personales.</p>
  <p>Tu deseo se guarda de forma an√≥nima en una hoja protegida. Solo se usa para mostrarlo aqu√≠.</p>
  <p>No vendemos, analizamos ni compartimos nada contigo. Aqu√≠ tus deseos son solo tuyos.</p>
  <p style="font-size: 13px; color: #888;">√öltima actualizaci√≥n: junio de 2025</p>
</section>

  <div id="cookieBanner" style="position: fixed; bottom: 0; left: 0; right: 0; background: #111; color: white; padding: 1em; font-size: 14px; display: flex; flex-direction: column; align-items: center; z-index: 9999;">
    <span style="margin-bottom: 0.5em; text-align: center;">
      Usamos cookies m√≠nimas para mejorar tu experiencia. No rastreamos, no vendemos, no te seguimos.<br>
      <a href="#politica-cookies" style="color: #ffd700; text-decoration: underline;">Leer m√°s</a>
    </span>
    <button onclick="aceptarCookies()" style="background: #ffd700; color: black; border: none; padding: 6px 16px; border-radius: 20px; cursor: pointer;">Aceptar</button>
  </div>


  <!-- ‚öôÔ∏è Script principal -->
<script>





let deseoReciente = null;




  const scriptURL = 'https://script.google.com/macros/s/AKfycbzCTUMu-CJtv_tzo-vJhx6-z-ft1n4HVx9DfAeHkwTtGVqpxtPbXA_mxOCmAeRtYR1Y/exec';
  let todosLosDeseos = [];

  function irAEscribir() {
    document.getElementById('seccion-escribir').scrollIntoView({ behavior: 'smooth' });
  }

  async function cargarDatosIniciales() {
    try {
      const res = await fetch(scriptURL);
      todosLosDeseos = await res.json();
      renderTop();
      renderVotacion();
    } catch (error) {
      console.error('Error al cargar los deseos:', error);
    }
  }

  function renderTop() {
    const top3 = [...todosLosDeseos]
      .sort((a, b) => b.votos - a.votos)
      .slice(0, 3);

    document.getElementById('top-semanal').innerHTML = top3.map(d =>
      `<div class="deseo">
        <div>${d.texto}</div>
        <div class="alias">‚Äî ${d.nombre || 'An√≥nimo'}</div>
        <div class="votos">üåü ${d.votos || 0} votos</div>
      </div>`
    ).join('');

    document.getElementById('contador-global').innerText =
      `üåé M√°s de ${todosLosDeseos.length} deseos enviados.`;
  }

function renderVotacion() {
  const contenedor = document.getElementById('zonaVotacion');
  let mezcla = [];

  if (deseoReciente) {
    // Incluye el nuevo deseo una vez
    const otros = todosLosDeseos.filter(d => d.id !== deseoReciente.id);
    const aleatorios = otros.sort(() => 0.5 - Math.random()).slice(0, 2);
    mezcla = [deseoReciente, ...aleatorios];
    deseoReciente = null; // ‚úÖ se muestra solo una vez
  } else {
    // Flujo normal
    mezcla = todosLosDeseos.sort(() => 0.5 - Math.random()).slice(0, 3);
  }


// Quitar cualquier pulso anterior
document.querySelectorAll('.pulso-temporal').forEach(el => el.classList.remove('pulso-temporal'));


  contenedor.innerHTML = mezcla.map(d => {
    const votosTexto = d.votos && d.votos > 0
      ? `<div class='votos' style='font-size:13px; color:#999; margin-top:4px;'>üåü ${d.votos} votos</div>`
      : '';
    return `
      <div class="deseo">
        <div>${d.texto}</div>
        <div class="alias">‚Äî ${d.nombre || 'An√≥nimo'}</div>
        ${votosTexto}
        <button class="boton-votar" onclick="votarDeseo('${d.id}')">‚ú® Votar</button>
      </div>`;
  }).join('');
}

  async function enviarDeseo() {
    const texto = document.getElementById('deseoInput').value.trim();
    const alias = document.getElementById('aliasInput').value.trim() || "An√≥nimo";
    if (!texto) return alert('Escribe un deseo antes de enviarlo.');

    const data = new FormData();
    data.append('deseo', texto);
    data.append('alias', alias);

    try {
      const res = await fetch(scriptURL, {
        method: 'POST',
        body: data
      });
      const result = await res.json();
      if (result.result === 'success') {
document.getElementById('resultadoEnvio').innerHTML = `
  <p>‚ú® Tu deseo fue enviado al universo.</p>
  <button class="boton" onclick="compartirDeseo('${texto}')">üì§ Compartir deseo</button>`;

document.getElementById('deseoInput').value = '';
document.getElementById('aliasInput').value = '';

// üëâ Crear el nuevo deseo una sola vez
const nuevoDeseo = {
  id: (todosLosDeseos.length + 1).toString().padStart(3, '0'),
  nombre: alias,
  texto: texto,
  votos: 0
};

// üëâ Guardar en memoria
todosLosDeseos.push(nuevoDeseo);
deseoReciente = nuevoDeseo; // se forzar√° a mostrar una sola vez

// üëâ Refrescar contador y lista
renderTop();
renderVotacion();

setTimeout(() => {
  const primerDeseo = document.querySelector('#zonaVotacion .deseo');
  if (primerDeseo) {
    primerDeseo.classList.add('pulso-temporal');
  }
}, 100);


}
 else {
        alert('Error al enviar el deseo.');
      }
    } catch (error) {
      console.error('Error al enviar:', error);
    }
  }

  function compartirDeseo(texto) {
    const mensaje = `Yo ya ped√≠ mi deseo al universo:\n${texto}\n‚ú® T√∫ tambi√©n puedes hacerlo en deseos.com`;
    const url = `https://wa.me/?text=${encodeURIComponent(mensaje)}`;
    window.open(url, '_blank');
  }

  async function votarDeseo(id) {
    const data = new FormData();
    data.append('desireId', id);
    const contenedor = document.getElementById('zonaVotacion');
    const boton = document.querySelector(`button[onclick="votarDeseo('${id}')"]`);

    if (boton) {
      boton.disabled = true;
      boton.innerHTML = '‚úÖ ¬°Gracias por tu voto!';
    }

    try {
      const res = await fetch(scriptURL, {
        method: 'POST',
        body: data
      });
      const result = await res.json();

      if (result.result === 'success') {
        // Actualiza votos en memoria
        const index = todosLosDeseos.findIndex(d => d.id === id);
        if (index !== -1) {
          todosLosDeseos[index].votos = (todosLosDeseos[index].votos || 0) + 1;
        }

        contenedor.style.opacity = '0';

        setTimeout(async () => {
          // Mostrar mensaje din√°mico de carga
          const mensaje = document.createElement('div');
          mensaje.innerText = 'üîÑ Cargando nuevos deseos inspiradores...';
          mensaje.style.fontSize = '14px';
          mensaje.style.color = '#777';
          mensaje.style.marginTop = '1em';
          mensaje.style.opacity = '0';
          mensaje.style.transition = 'opacity 0.3s ease';
          contenedor.innerHTML = '';
          contenedor.appendChild(mensaje);
          setTimeout(() => { mensaje.style.opacity = '1'; }, 10);

          renderVotacion();
          renderTop();

          mensaje.remove();
          contenedor.style.opacity = '1';
        }, 100);

      } else {
        alert('Error al votar.');
        if (boton) {
          boton.disabled = false;
          boton.innerHTML = '‚ú® Votar';
        }
      }
    } catch (error) {
      console.error('Error al votar:', error);
      if (boton) {
        boton.disabled = false;
        boton.innerHTML = '‚ú® Votar';
      }
    }
  }


  // Inicia al cargar
  cargarDatosIniciales();


// üßÅ Gesti√≥n de cookies
document.addEventListener('DOMContentLoaded', () => {
  const banner = document.getElementById("cookieBanner");
  if (!banner) return;

  if (localStorage.getItem("cookiesAceptadas") === "true") {
    banner.style.display = "none";
  } else {
    banner.style.display = "block";
  }
});

function aceptarCookies() {
  localStorage.setItem("cookiesAceptadas", "true");
  const banner = document.getElementById("cookieBanner");
  if (banner) banner.style.display = "none";
}





</script>

</body>
</html>
